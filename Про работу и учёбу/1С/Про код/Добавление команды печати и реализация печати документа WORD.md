#1С
Довольно часто пользователи 1С просят разработать печатную формы в формате файлов MS Word. Это обусловлено широкими возможностями форматирования этого типа документа либо удобством его дальнейшего использования и хранения. В этой статье я хочу описать надежный и простой алгоритм создания внешних печатных форм, который я использую для решения поставленных задач. Дополнительным преимуществом этого алгоритма является то, что не требуется вносить изменения в основную конфигурацию. Т.е. используется для конфигураций, находящихся на поддержке без возможности изменения.

  

Весь принцип реализации строиться на использовании расширения. Причем, добавлять в расширение объекты основной конфигурации практически не нужно. Это очень удобно для дальнейших обновлений конфигураций с расширениями. Возникает вопрос: «А при чем здесь внешняя печатная форма, ведь это расширение?». Дело в том, что расширение легко устанавливается в программу в пользовательском режиме. А если еще ее объекты обособленны от объектов основной конфигурации, то, я думаю, можно называть ее внешней.

  

Пожалуй, единственным ограничением является наличие в конфигурации Библиотеки стандартных подсистем (далее – БСП). Данный метод «активно» использует механизмы этой библиотеки, поэтому БСП должно быть интегрировано в конфигурацию информационной базы (далее – ИБ). Но здесь особо беспокоиться не нужно, т.к. БСП сейчас присутствует практически во всех типовых конфигурациях.

  

Перед тем как продемонстрировать пример разработки, предлагаю ознакомиться с чек-листом и представить общую последовательность действий.  

  

# 1. Чек-лист разработки для создания внешней печатной формы

  

1.Создать расширение в конфигурации ИБ

2.В расширении добавить новую обработку (далее Обработка)

3.Обработку включить в подсистему ПодключаемыеОтчетыИОбработки

4.Создать шаблон (документ в формате MS Word) с необходимым содержанием и установить параметры

5.В обработку добавить макет и загрузить в него файл шаблона, созданного в пункте 4

6.В обработку добавить форму и в модуле формы создать функцию:

·         ВыполнитьКомандуПечати – экспортная, пользовательская

7.В модуле менеджера обработки создать 3 процедуры и 4 функции:

·         ПриОпределенииНастроек - экспортная, предопределенная БСП

·         ДобавитьКомандыПечати - экспортная, предопределенная БСП

·         Печать - экспортная, предопределенная БСП

·         ПолучитьДанныеПечати - экспортная, предопределенная БСП

·         ПолучитьДанныеОбъекта – пользовательская

·         ОбластиМакетаОфисногоДокумента – пользовательская

·         НапечататьДокумент– пользовательская  

  

# 2. Пример разработки в 1С 8.3 Зарплата и управление персоналом

  

Давайте рассмотрим этот процесс на примере создания печатной формы дополнительного соглашения к трудовому договору в формате файла MS Word. В качестве информационной базы я буду использовать конфигурацию 1C 8.3 Зарплата и управление персоналом версии 3.1.14.183, установленную на платформе 1С:Предприятие 8.3 (8.3.17.1496). В данной конфигурации используется БСП версии 3.1.2.469.

  

### 1.Создаем расширение в конфигурации ИБ.

Запускаем 1С:Предприятие в режиме конфигуратора. Открываем список расширений с помощью команды «Расширения конфигурации» пункта меню «Конфигурация» и добавляем новое расширение. После добавления расширения в список, необходимо будет снять флажок «Безопасный режим» как это показано на Рис.1. Если безопасный режим оставить включенным, то при печати нашей формы программа будет «ругаться».
[![Расширение конфигурации в 1С 8.3 ЗУП](https://www.koderline.ru/upload/iblock/c65/1s-sozdanie-vneshnej-pechatnoj-formy.png)](https://www.koderline.ru/upload/iblock/c65/1s-sozdanie-vneshnej-pechatnoj-formy.png)Рис. 1 Расширение конфигурации в 1С 8.3 Зарплата и управление персоналом

### 2.Добавляем в расширение новую обработку.
Делаем двойной клик по строке списка с нашим расширением и открываем конфигурацию расширения. В дереве конфигурации находим «Обработки» … выделяем … правая клавиша мышки … Добавить. Я назвал обработку «Расш1_ПечатьWord».

### 3. Включаем обработку в подсистему ПодключаемыеОтчетыИОбработки.
Для этого необходимо добавить в расширение подсистему ПодключаемыеОтчетыИОбработки из основной конфигурации. Переходим в окно основной конфигурации, находим подсистему ПодключаемыеОтчетыИОбработки в дереве, выделяем и через контекстное меню жмем команду «Добавить в расширение» (см. Рис.2)
[![Добавление в расширение в 1С 8.3 Зарплата и управление персоналом](https://www.koderline.ru/upload/iblock/19d/sozdanie-vneshnej-pechatnoj-formy.png)](https://www.koderline.ru/upload/iblock/19d/sozdanie-vneshnej-pechatnoj-formy.png)Рис. 2 Добавление в расширение в 1С 8.3 Зарплата и управление персоналом
Возвращаемся в окно конфигурации расширения, находим добавленную нами подсистему и уже здесь в ее состав добавляем нашу обработку.

### 4.Создаем шаблон-документ Word с необходимым содержанием и параметрами.
На этом этапе берем шаблон доп. соглашения – документ в формате MS Word c расширением .docx, устанавливаем разделители областей вывода, а в местах, где необходимо подставить значения из базы 1С устанавливаем маркеры параметров.
Разделитель области предназначен для того, чтобы «именовать» части документа-шаблона для дальнейшего вывода средствами встроенного языка 1С. Разделители представляют собой пару - открывающий тэг {v8 Область.<Имя области>} в самом начале области документа и закрывающий тэг {/v8 Область.<Имя области>} в самом конце области документа.
В этом примере я не буду рассматривать ситуацию с выводом нескольких областей. В большинстве случаев это и не требуется. Например, для вывода не сложной формы дополнительного соглашения к трудовому договору достаточно весь документ поместить в одну область. Так ее и назовем «ВесьДокумент».
Маркеры параметров выполняют такую же роль, как и параметры стандартных печатных макетов, и имеют следующий формат {v8 <Имя параметра>}[![Документ в формате MS Word](https://www.koderline.ru/upload/iblock/40e/3-sozdanie-pechatnoj-formy-v-1s.png)](https://www.koderline.ru/upload/iblock/40e/3-sozdanie-pechatnoj-formy-v-1s.png) Рис. 3 Документ в формате MS Word

### 5. Добавляем в обработку макет и загружаем в него файл шаблона.
Добавляем в обработку макет. Тип макета – двоичные данные. Название должно начинаться с префикса ПФ_DOC_ Для этого примера я назвал его «ПФ_DOC_ДопСоглашение».
Далее кликаем по макету печатной формы и открывается форма с кнопкой «Загрузить из файла». Загружаем наш шаблон .docx, созданный ранее(пункт 4).

### 6. В обработку добавляем форму.
Теперь в нашей обработке «Расш1_ПечатьWord» создаем форму. Форма должна быть основной, поэтому при создании формы важно, чтобы флажок «Назначить форму основной» был установлен.
В модуль формы копируем функцию с Рис.4
[![Команда печати в 1С 8.3 Зарплата и управление персоналом](https://www.koderline.ru/upload/iblock/914/4-word-maket-dokumenta.png)](https://www.koderline.ru/upload/iblock/914/4-word-maket-dokumenta.png) Рис. 4 Функция модуля формы в 1С 8.3 Зарплата и управление персоналом

### 7. В модуле менеджера обработки создадим необходимые процедуры и функции.
На данном этапе все просто. Копируем в модуль менеджера обработки тексты процедур и функций, представленные на листингах ниже. Необходимо лишь заменить отдельные участки (я их подчеркнул красными линиями) в соответствии с конкретной задачей.

### 7.1 ПриОпределенииНастроек
Данная процедура является предопределенной БСП, поэтому название нужно сохранить. Изменить можно размещение (подчеркнуто красным). В моем примере команда печати должна располагаться в справочнике сотрудники.
[![Команда печати в 1С 8.3 Зарплата и управление персоналом](https://www.koderline.ru/upload/iblock/9b2/5-word-maket-dokumenta-1s.png)](https://www.koderline.ru/upload/iblock/9b2/5-word-maket-dokumenta-1s.png)Рис. 5 Команда печати в 1С 8.3 Зарплата и управление персоналом

### 7.2 ДобавитьКомандыПечати
Данная процедура является предопределенной БСП поэтому название нужно сохранить. Здесь мы описывает команду, которая будет запускать печать нашей формы. Свойство МенеджерПечати определяет нахождение модуля менеджера где располагается процедура Печать. Свойство Обработчик определяет нахождение и название клиентского обработчика команды. В нашем случае он располагается на форме обработки.[![печать в 1С 8.3 Зарплата и управление персоналом](https://www.koderline.ru/upload/iblock/ac5/6-word-maket-v-1s.png)](https://www.koderline.ru/upload/iblock/ac5/6-word-maket-v-1s.png) Рис. 6 Добавление команды печати в 1С 8.3 Зарплата и управление персоналом

  

### 7.3 Печать
Данная процедура является предопределенной БСП поэтому название нужно сохранить. В переменную ИдентификаторКоманды и ИмяМенеджераПечати устанавливаем имя идентификатора и менеджера печати из процедуры ДобавитьКомандуПечати (пункт 7.2).[![Процедура печати в 1С 8.3 Зарплата и управление персоналом](https://www.koderline.ru/upload/iblock/a51/7-format-dokumenta-ms-word.png)](https://www.koderline.ru/upload/iblock/a51/7-format-dokumenta-ms-word.png) Рис. 7 Процедура печати в 1С 8.3 Зарплата и управление персоналом

  

### 7.4 ПолучитьДанныеПечати
Данная функция является предопределенной БСП поэтому название нужно сохранить. Аналогично предыдущему шагу, устанавливаем в переменную ИдентификаторКоманды имя идентификатора из процедуры ДобавитьКомандуПечати.
В параметр функции УправлениеПечатью.МакетПечатнойФормы устанавливаем полный путь к макету печатной формы, созданному в пункте 5 нашей статьи.
[![Получение данных объекта в 1С 8.3](https://www.koderline.ru/upload/iblock/dc4/8-format-dokumenta-ms-word-1s.png)](https://www.koderline.ru/upload/iblock/dc4/8-format-dokumenta-ms-word-1s.png)
Рис. 8 Получение данных печати в 1С 8.3 Зарплата и управление персоналом

### 7.5 ПолучитьДанныеОбъекта
В этой функции необходимо создать структуру с данными, которыми будет заполняться печатная форма. Ключ структуры – имя параметра шаблона Word {v8 <Имя параметра>}, а значение – значение из базы 1С. Параметр функции СсылкаНаОбъект – ссылка на объект печати. В нашем случае это ссылка на сотрудника.
[![Получение данных объекта в 1С 8.3 Зарплата и управление персоналом](https://www.koderline.ru/upload/iblock/8fb/9-format-dokumenta-ms.png)](https://www.koderline.ru/upload/iblock/8fb/9-format-dokumenta-ms.png) Рис. 9 Получение данных объекта в 1С 8.3 Зарплата и управление персоналом

  

### 7.6 ОбластиМакетаОфисногоДокумента
Здесь описываем области и устанавливаем типы. 
Возможные типы областей:

·         Общая – используется однократно.
·         СтрокаТаблицы – используется для вывода множества строк;
·         Список – используется для вывода множества строк;
·         ВерхнийКолонтитул;
·         НижнийКолонтитул;

[![документ в 1С 8.3 Зарплата и управление персоналом](https://www.koderline.ru/upload/iblock/88c/10-biblioteka-standartnyh-podsistem.png)](https://www.koderline.ru/upload/iblock/88c/10-biblioteka-standartnyh-podsistem.png) Рис. 10 Области макета в 1С 8.3 Зарплата и управление персоналом

  

### 7.7 НапечататьДокумент
Эта функция отвечает за вывод и заполнение областей. В блоке, отмеченном красной линией, нужно описать последовательный вывод областей. Здесь меняем/устанавливаем только название области. В нашем случае «ВесьДокумент»
[![Функция напечатать документ в 1С 8.3 Зарплата и управление персоналом](https://www.koderline.ru/upload/iblock/e18/11-biblioteka-standartnyh-podsistem-1s.png)](https://www.koderline.ru/upload/iblock/e18/11-biblioteka-standartnyh-podsistem-1s.png)Рис. 11 Функция напечатать документ в 1С 8.3 Зарплата и управление персоналом
На этом все. Запускаем печать и получаем ожидаемый результат.
[![Печать макета документа Word](https://www.koderline.ru/upload/iblock/d66/12-biblioteka-standartnyh-podsistem-v-1s.png)](https://www.koderline.ru/upload/iblock/d66/12-biblioteka-standartnyh-podsistem-v-1s.png)Рис. 12 Печать макета документа Word
В заключении хотелось бы добавить, что с помощью одной такой обработки можно реализовать множество различных команд печати документа.
В интернете можно найти множество авторских методик создания внешней печатной формы в формате документа MS Word, однако, методы на основе БСП являются наиболее надежными.